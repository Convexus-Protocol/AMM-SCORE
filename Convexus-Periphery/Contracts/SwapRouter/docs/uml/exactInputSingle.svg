<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1097px" preserveAspectRatio="none" style="width:1208px;height:1097px;background:#FFFFFF;" version="1.1" viewBox="0 0 1208 1097" width="1208px" zoomAndPan="magnify"><defs><filter height="300%" id="f19iag3u2usqan" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f19iag3u2usqan)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="967" y="768.7422"/><rect fill="#FFFFFF" filter="url(#f19iag3u2usqan)" height="468.8516" style="stroke:#000000;stroke-width:2.0;" width="796.5" x="63" y="141.8281"/><rect fill="#ADD8E6" filter="url(#f19iag3u2usqan)" height="50.2656" style="stroke:#000000;stroke-width:2.0;" width="167" x="1027" y="987.0703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="115" x2="115" y1="40.2969" y2="1054.3359"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="456" x2="456" y1="40.2969" y2="1054.3359"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="796.5" x2="796.5" y1="40.2969" y2="1054.3359"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="972" x2="972" y1="40.2969" y2="1054.3359"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1110" x2="1110" y1="40.2969" y2="1054.3359"/><rect fill="#FEFECE" filter="url(#f19iag3u2usqan)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="73" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="80" y="24.9951">recipient</text><rect fill="#FEFECE" filter="url(#f19iag3u2usqan)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="73" y="1053.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="80" y="1073.3311">recipient</text><rect fill="#FEFECE" filter="url(#f19iag3u2usqan)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="68" x="420" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="427" y="24.9951">Token0</text><rect fill="#FEFECE" filter="url(#f19iag3u2usqan)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="68" x="420" y="1053.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="427" y="1073.3311">Token0</text><rect fill="#FEFECE" filter="url(#f19iag3u2usqan)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="101" x="744.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="751.5" y="24.9951">SwapRouter</text><rect fill="#FEFECE" filter="url(#f19iag3u2usqan)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="101" x="744.5" y="1053.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="751.5" y="1073.3311">SwapRouter</text><rect fill="#FEFECE" filter="url(#f19iag3u2usqan)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="136" x="902" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="909" y="24.9951">ConvexusFactory</text><rect fill="#FEFECE" filter="url(#f19iag3u2usqan)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="136" x="902" y="1053.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="909" y="1073.3311">ConvexusFactory</text><rect fill="#FEFECE" filter="url(#f19iag3u2usqan)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="113" x="1052" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="1059" y="24.9951">ConvexusPool</text><rect fill="#FEFECE" filter="url(#f19iag3u2usqan)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="113" x="1052" y="1053.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="1059" y="1073.3311">ConvexusPool</text><rect fill="#FFFFFF" filter="url(#f19iag3u2usqan)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="967" y="768.7422"/><path d="M5,55.2969 L5,125.2969 L222,125.2969 L222,65.2969 L212,55.2969 L5,55.2969 " fill="#FBFB77" filter="url(#f19iag3u2usqan)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M212,55.2969 L212,65.2969 L222,65.2969 L212,55.2969 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="11" y="72.3638">recipient</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="82" y="72.3638">wants to swap</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="11" y="87.4966">amount0 of token0 for a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="11" y="102.6294">minimum amountOutMinimum</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="11" y="117.7622">of token1</text><path d="M63,141.8281 L331,141.8281 L331,148.8281 L321,158.8281 L63,158.8281 L63,141.8281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="468.8516" style="stroke:#000000;stroke-width:2.0;" width="796.5" x="63" y="141.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="223" x="78" y="154.895">Transfer amount0 of token0</text><polygon fill="#A80036" points="444,372.8203,454,376.8203,444,380.8203,448,376.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="115" x2="450" y1="376.8203" y2="376.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="122" y="175.0278">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="190" y="175.0278">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="134" y="190.1606">SwapRouter,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="134" y="205.2935">amount0, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="142" y="220.4263">"method":"exactInputSingle",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="142" y="235.5591">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="150" y="250.6919">"tokenOut": token1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="150" y="265.8247">"fee": fee,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="150" y="280.9575">"recipient": recipient,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="150" y="296.0903">"deadline": deadline,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="150" y="311.2231">"amountOutMinimum": amountOutMinimum,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="150" y="326.356">"sqrtPriceLimitX96": sqrtPriceLimitX96</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="138" y="341.4888">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="130" y="356.6216">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="122" y="371.7544">)</text><polygon fill="#A80036" points="785,598.6797,795,602.6797,785,606.6797,789,602.6797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="791" y1="602.6797" y2="602.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="463" y="400.8872">tokenFallback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="573" y="400.8872">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="475" y="416.02">recipient,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="475" y="431.1528">amount0, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="483" y="446.2856">"method":"exactInputSingle",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="483" y="461.4185">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="491" y="476.5513">"tokenOut": token1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="491" y="491.6841">"fee": fee,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="491" y="506.8169">"recipient": recipient,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="491" y="521.9497">"deadline": deadline,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="491" y="537.0825">"amountOutMinimum": amountOutMinimum,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="491" y="552.2153">"sqrtPriceLimitX96": sqrtPriceLimitX96</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="479" y="567.3481">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="471" y="582.481">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="463" y="597.6138">)</text><path d="M646,622.6797 L646,677.6797 L944,677.6797 L944,632.6797 L934,622.6797 L646,622.6797 " fill="#FBFB77" filter="url(#f19iag3u2usqan)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M934,622.6797 L934,632.6797 L944,632.6797 L934,622.6797 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="92" x="652" y="639.7466">SwapRouter</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="748" y="639.7466">queries</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130" x="799" y="639.7466">ConvexusFactory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="652" y="654.8794">using the received params for retrieving</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="652" y="670.0122">the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="105" x="677" y="670.0122">ConvexusPool</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="786" y="670.0122">address</text><polygon fill="#A80036" points="955,764.7422,965,768.7422,955,772.7422,959,768.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="797" x2="961" y1="768.7422" y2="768.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="60" x="804" y="703.145">getPool</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="868" y="703.145">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="812" y="718.2778">"token0": token0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="812" y="733.4106">"token1": token1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="812" y="748.5435">"fee": fee,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="804" y="763.6763">)</text><polygon fill="#A80036" points="808,793.875,798,797.875,808,801.875,804,797.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="802" x2="971" y1="797.875" y2="797.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="814" y="792.8091">ConvexusPool address</text><path d="M686,810.875 L686,850.875 L903,850.875 L903,820.875 L893,810.875 L686,810.875 " fill="#FBFB77" filter="url(#f19iag3u2usqan)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M893,810.875 L893,820.875 L903,820.875 L893,810.875 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="692" y="827.9419">Performs the Core Layer swap</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="692" y="843.0747">to the queried ConvexusPool</text><polygon fill="#A80036" points="1098.5,968.0703,1108.5,972.0703,1098.5,976.0703,1102.5,972.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="797" x2="1104.5" y1="972.0703" y2="972.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="38" x="804" y="876.2075">swap</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="846" y="876.2075">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="812" y="891.3403">recipient,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="812" y="906.4731">true,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="812" y="921.606">amount0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="812" y="936.7388">sqrtPriceLimitX96,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="812" y="951.8716">bytes(SwapCallbackData)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="804" y="967.0044">)</text><path d="M1027,987.0703 L1154,987.0703 L1154,994.0703 L1144,1004.0703 L1027,1004.0703 L1027,987.0703 " fill="#FFD700" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="50.2656" style="stroke:#000000;stroke-width:2.0;" width="167" x="1027" y="987.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="82" x="1042" y="1000.1372">Core Layer</text><rect fill="#FBFB77" filter="url(#f19iag3u2usqan)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="147" x="1037" y="1009.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="1041" y="1025.27">Tokens Swap process</text><!--MD5=[4a3de959f2ca9b9176acdbfe6ea44d41]
@startuml
note over recipient
**recipient** wants to swap
amount0 of token0 for a
minimum amountOutMinimum
of token1
end note

group Transfer amount0 of token0

' Send the tokens to the SwapRouter contract
recipient -> Token0 : **transfer** ( \n   SwapRouter, \n   amount0, { \n     "method":"exactInputSingle", \n     "params": {\n       "tokenOut": token1, \n       "fee": fee, \n       "recipient": recipient, \n       "deadline": deadline, \n       "amountOutMinimum": amountOutMinimum, \n       "sqrtPriceLimitX96": sqrtPriceLimitX96 \n    } \n  } \n)

Token0 -> SwapRouter : **tokenFallback** ( \n   recipient, \n   amount0, { \n     "method":"exactInputSingle", \n     "params": {\n       "tokenOut": token1, \n       "fee": fee, \n       "recipient": recipient, \n       "deadline": deadline, \n       "amountOutMinimum": amountOutMinimum, \n       "sqrtPriceLimitX96": sqrtPriceLimitX96 \n    } \n  } \n)

end group

note over SwapRouter
**SwapRouter** queries **ConvexusFactory**
using the received params for retrieving
the **ConvexusPool** address
end note

SwapRouter -> ConvexusFactory : **getPool** ( \n  "token0": token0, \n  "token1": token1, \n  "fee": fee, \n)
activate ConvexusFactory
return ConvexusPool address

note over SwapRouter
Performs the Core Layer swap
to the queried ConvexusPool 
end note

' The SwapRouter contract performs the swap method
SwapRouter -> ConvexusPool : **swap** ( \n  recipient, \n  true, \n  amount0, \n  sqrtPriceLimitX96, \n  bytes(SwapCallbackData) \n)

group#Gold #LightBlue Core Layer
  rnote over ConvexusPool
    Tokens Swap process
  endrnote
end
@enduml

@startuml
note over recipient
**recipient** wants to swap
amount0 of token0 for a
minimum amountOutMinimum
of token1
end note

group Transfer amount0 of token0

recipient -> Token0 : **transfer** ( \n   SwapRouter, \n   amount0, { \n     "method":"exactInputSingle", \n     "params": {\n       "tokenOut": token1, \n       "fee": fee, \n       "recipient": recipient, \n       "deadline": deadline, \n       "amountOutMinimum": amountOutMinimum, \n       "sqrtPriceLimitX96": sqrtPriceLimitX96 \n    } \n  } \n)

Token0 -> SwapRouter : **tokenFallback** ( \n   recipient, \n   amount0, { \n     "method":"exactInputSingle", \n     "params": {\n       "tokenOut": token1, \n       "fee": fee, \n       "recipient": recipient, \n       "deadline": deadline, \n       "amountOutMinimum": amountOutMinimum, \n       "sqrtPriceLimitX96": sqrtPriceLimitX96 \n    } \n  } \n)

end group

note over SwapRouter
**SwapRouter** queries **ConvexusFactory**
using the received params for retrieving
the **ConvexusPool** address
end note

SwapRouter -> ConvexusFactory : **getPool** ( \n  "token0": token0, \n  "token1": token1, \n  "fee": fee, \n)
activate ConvexusFactory
return ConvexusPool address

note over SwapRouter
Performs the Core Layer swap
to the queried ConvexusPool 
end note

SwapRouter -> ConvexusPool : **swap** ( \n  recipient, \n  true, \n  amount0, \n  sqrtPriceLimitX96, \n  bytes(SwapCallbackData) \n)

group#Gold #LightBlue Core Layer
  rnote over ConvexusPool
    Tokens Swap process
  endrnote
end
@enduml

PlantUML version 1.2022.1beta4(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>