<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="948px" preserveAspectRatio="none" style="width:772px;height:948px;background:#FFFFFF;" version="1.1" viewBox="0 0 772 948" width="772px" zoomAndPan="magnify"><defs><filter height="300%" id="f1mb4xt28tegf0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1mb4xt28tegf0)" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="430.5" x="245.5" y="246.625"/><rect fill="#FFFFFF" filter="url(#f1mb4xt28tegf0)" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="692" x="66" y="661.5469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="107" x2="107" y1="40.2969" y2="905.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="313.5" x2="313.5" y1="40.2969" y2="905.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="469" x2="469" y1="40.2969" y2="905.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="624" x2="624" y1="40.2969" y2="905.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="712" x2="712" y1="40.2969" y2="905.2734"/><rect fill="#FEFECE" filter="url(#f1mb4xt28tegf0)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="58" x="76" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="83" y="24.9951">Callee</text><rect fill="#FEFECE" filter="url(#f1mb4xt28tegf0)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="58" x="76" y="904.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="83" y="924.2686">Callee</text><rect fill="#FEFECE" filter="url(#f1mb4xt28tegf0)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="113" x="255.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="262.5" y="24.9951">ConvexusPool</text><rect fill="#FEFECE" filter="url(#f1mb4xt28tegf0)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="113" x="255.5" y="904.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="262.5" y="924.2686">ConvexusPool</text><rect fill="#FEFECE" filter="url(#f1mb4xt28tegf0)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="68" x="433" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="440" y="24.9951">Token1</text><rect fill="#FEFECE" filter="url(#f1mb4xt28tegf0)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="68" x="433" y="904.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="440" y="924.2686">Token1</text><rect fill="#FEFECE" filter="url(#f1mb4xt28tegf0)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="582" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="589" y="24.9951">recipient</text><rect fill="#FEFECE" filter="url(#f1mb4xt28tegf0)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="582" y="904.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="589" y="924.2686">recipient</text><rect fill="#FEFECE" filter="url(#f1mb4xt28tegf0)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="68" x="676" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="683" y="24.9951">Token0</text><rect fill="#FEFECE" filter="url(#f1mb4xt28tegf0)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="68" x="676" y="904.2734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="683" y="924.2686">Token0</text><polygon fill="#A80036" points="302,158.2266,312,162.2266,302,166.2266,306,162.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="107" x2="308" y1="162.2266" y2="162.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="38" x="114" y="66.3638">swap</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="156" y="66.3638">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="122" y="81.4966">recipient,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="122" y="96.6294">true,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="122" y="111.7622">amount0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="122" y="126.895">sqrtPriceLimitX96,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="122" y="142.0278">bytes(recipient)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="114" y="157.1606">)</text><path d="M201,175.2266 L201,230.2266 L423,230.2266 L423,185.2266 L413,175.2266 L201,175.2266 " fill="#FBFB77" filter="url(#f1mb4xt28tegf0)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M413,175.2266 L413,185.2266 L423,185.2266 L413,175.2266 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="105" x="207" y="192.2935">ConvexusPool</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="316" y="192.2935">compute</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="207" y="207.4263">the correct amount1 of token1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="207" y="222.5591">and transfer it to recipient</text><path d="M245.5,246.625 L511.5,246.625 L511.5,253.625 L501.5,263.625 L245.5,263.625 L245.5,246.625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="430.5" x="245.5" y="246.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="221" x="260.5" y="259.6919">Transfer amount1 of token1</text><polygon fill="#A80036" points="457,356.5547,467,360.5547,457,364.5547,461,360.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="314" x2="463" y1="360.5547" y2="360.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="321" y="279.8247">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="389" y="279.8247">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="337" y="294.9575">recipient,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="337" y="310.0903">amount1, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="345" y="325.2231">"method": "pay"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="337" y="340.356">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="329" y="355.4888">)</text><polygon fill="#A80036" points="612,461.3516,622,465.3516,612,469.3516,616,465.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="469" x2="618" y1="465.3516" y2="465.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="476" y="384.6216">tokenFallback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="586" y="384.6216">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="492" y="399.7544">ConvexusPool,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="492" y="414.8872">amount1, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="500" y="430.02">"method": "pay"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="492" y="445.1528">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="484" y="460.2856">)</text><polygon fill="#A80036" points="118,558.0156,108,562.0156,118,566.0156,114,562.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="112" x2="313" y1="562.0156" y2="562.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="170" x="124" y="496.4185">convexusSwapCallback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="298" y="496.4185">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="132" y="511.5513">amount0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="132" y="526.6841">amount1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="132" y="541.8169">recipient</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="124" y="556.9497">)</text><path d="M5,575.0156 L5,645.0156 L206,645.0156 L206,585.0156 L196,575.0156 L5,575.0156 " fill="#FBFB77" filter="url(#f1mb4xt28tegf0)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M196,575.0156 L196,585.0156 L206,585.0156 L196,575.0156 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="45" x="11" y="592.0825">Callee</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="60" y="592.0825">must pay back</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="11" y="607.2153">the given amount0 and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="11" y="622.3481">amount1 or the transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="11" y="637.481">will revert</text><path d="M66,661.5469 L334,661.5469 L334,668.5469 L324,678.5469 L66,678.5469 L66,661.5469 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="226.7266" style="stroke:#000000;stroke-width:2.0;" width="692" x="66" y="661.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="223" x="81" y="674.6138">Transfer amount0 of token0</text><polygon fill="#A80036" points="700,771.4766,710,775.4766,700,779.4766,704,775.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="107" x2="706" y1="775.4766" y2="775.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="114" y="694.7466">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="182" y="694.7466">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="130" y="709.8794">ConvexusPool,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="130" y="725.0122">amount0, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="138" y="740.145">"method": "pay"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="130" y="755.2778">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="122" y="770.4106">)</text><polygon fill="#A80036" points="325,876.2734,315,880.2734,325,884.2734,321,880.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="319" x2="711" y1="880.2734" y2="880.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="331" y="799.5435">tokenFallback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="441" y="799.5435">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="347" y="814.6763">Callee,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="347" y="829.8091">amount0, {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="355" y="844.9419">"method": "pay"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="347" y="860.0747">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="339" y="875.2075">)</text><!--MD5=[c87bb177a72abf93efe744797478d21a]
@startuml
' The Callee contract performs the swap method
Callee -> ConvexusPool : **swap** ( \n  recipient, \n  true, \n  amount0, \n  sqrtPriceLimitX96, \n  bytes(recipient) \n)

note over ConvexusPool : **ConvexusPool** compute \nthe correct amount1 of token1 \nand transfer it to recipient


group Transfer amount1 of token1
  ' The swapped tokens are paid back to the recipient
  ConvexusPool -> Token1 : **transfer** ( \n    recipient, \n    amount1, { \n      "method": "pay" \n    } \n  )

  Token1 -> recipient : **tokenFallback** ( \n    ConvexusPool, \n    amount1, { \n      "method": "pay" \n    } \n  )
end group

ConvexusPool -> Callee : **convexusSwapCallback** ( \n  amount0, \n  amount1, \n  recipient \n)

note over Callee : **Callee** must pay back \nthe given amount0 and \namount1 or the transaction \nwill revert

group Transfer amount0 of token0

  ' The Callee contract send the required amount0 of token0
  Callee -> Token0 : **transfer** ( \n    ConvexusPool, \n    amount0, { \n      "method": "pay" \n    } \n  )

  Token0 -> ConvexusPool : **tokenFallback** ( \n    Callee, \n    amount0, { \n      "method": "pay" \n    } \n  )

end group
@enduml

@startuml
Callee -> ConvexusPool : **swap** ( \n  recipient, \n  true, \n  amount0, \n  sqrtPriceLimitX96, \n  bytes(recipient) \n)

note over ConvexusPool : **ConvexusPool** compute \nthe correct amount1 of token1 \nand transfer it to recipient


group Transfer amount1 of token1
  ConvexusPool -> Token1 : **transfer** ( \n    recipient, \n    amount1, { \n      "method": "pay" \n    } \n  )

  Token1 -> recipient : **tokenFallback** ( \n    ConvexusPool, \n    amount1, { \n      "method": "pay" \n    } \n  )
end group

ConvexusPool -> Callee : **convexusSwapCallback** ( \n  amount0, \n  amount1, \n  recipient \n)

note over Callee : **Callee** must pay back \nthe given amount0 and \namount1 or the transaction \nwill revert

group Transfer amount0 of token0

  Callee -> Token0 : **transfer** ( \n    ConvexusPool, \n    amount0, { \n      "method": "pay" \n    } \n  )

  Token0 -> ConvexusPool : **tokenFallback** ( \n    Callee, \n    amount0, { \n      "method": "pay" \n    } \n  )

end group
@enduml

PlantUML version 1.2022.1beta4(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>